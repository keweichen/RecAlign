(()=>{"use strict";const e=new Map;function t(e){const t=e.getBoundingClientRect(),n=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(t.bottom<0||t.top-n>=0)}let n=!1;setInterval((()=>{n||(n=!0,"https://twitter.com/home"===window.location.href||"https://www.twitter.com/home"===window.location.href?chrome.storage.sync.get(["twitter"]).then((n=>{if(null==n.twitter&&(n.twitter=!0),n.twitter){console.log("Extension running...");const n=document.querySelectorAll("article[data-testid='tweet']"),o=[],s=Array.prototype.filter.call(n,(e=>t(e))),l=[],c=[];for(let t=0;t<s.length;t++){const n=s[t].querySelector("div[data-testid='tweetText']");if(null==n){console.log("[DISCOVERY] fail to find tweet text for "+s[t].textContent.replaceAll("\n","")),o.push("");continue}const i=n.textContent.replaceAll("\n","");o.push(i);const a=s[t].closest("div[data-testid='cellInnerDiv']");!e.has(o[t])&&a&&(a.style.opacity="0.3"),e.has(i)||(l.push(i),c.push(s[t]))}if(0==l.length)return;chrome.storage.sync.get(["preference","openai_api_key"]).then((t=>{console.log("Preference is "+t.preference);const n={messages:l,preference:t.preference,openai_api_key:t.openai_api_key},c=new XMLHttpRequest;c.open("POST","https://hiubwe6637gmpslsccd4ofi3de0yaeqa.lambda-url.us-east-2.on.aws/"),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.send(JSON.stringify(n)),console.log("[Backend]","Request sent..."),c.onloadend=function(){const t=JSON.parse(c.responseText);console.log("[BACKEND]",t);for(let n=0;n<t.length;n++)e.set(l[n],t[n]);for(let t=0;t<s.length;t++)e.has(o[t])?e.get(o[t])?(s[t].closest("div[data-testid='cellInnerDiv']").style.opacity="1",console.log("[KEEP] keeping tweet"+s[t].textContent.replaceAll("\n",""))):(s[t].closest("div[data-testid='cellInnerDiv']").style.display="none",console.log("[REMOVE] tweet"+s[t].textContent.replaceAll("\n",""))):console.log("[ERROR] cache does not contain tweet "+l[t])}}))}})):"https://www.coinbase.com/home"!==window.location.href&&"https://www.coinbase.com/follow"!==window.location.href||chrome.storage.sync.get(["coinbase"]).then((n=>{if(null==n.coinbase&&(n.coinbase=!0),n.coinbase){console.log("coinbase extension running...");let n=document.querySelectorAll("section[class^='InfiniteScroll'] > div[data-element='Box']"),o=[],s=Array.prototype.filter.call(n,(function(e){return t(e)}));console.log("visibleContainers",s);let l=[],c=[];for(let t=0;t<s.length;t++){const n=s[t].querySelector("p[data-element^='Text']");if(null==n){console.log("[DISCOVERY] fail to find tweet text for "+s[t].textContent.replaceAll("\n","")),o.push("");continue}const i=n.textContent.replaceAll("\n","");o.push(i);const a=s[t].closest("div");!e.has(o[t])&&a&&(a.style.opacity="0.3"),e.has(i)||(l.push(i),c.push(s[t]))}if(0==l.length)return;chrome.storage.sync.get(["preference","openai_api_key"]).then((t=>{console.log("Value currently is "+t.preference);const n=t.preference,c={messages:l,preference:n,openai_api_key:t.openai_api_key},i=new XMLHttpRequest;i.open("POST","https://hiubwe6637gmpslsccd4ofi3de0yaeqa.lambda-url.us-east-2.on.aws/"),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(c)),console.log("[Backend]","Request sent..."),i.onloadend=function(){const t=JSON.parse(i.responseText);console.log("[BACKEND]",t);for(let n=0;n<t.length;n++)e.set(l[n],t[n]);for(let t=0;t<s.length;t++)e.has(o[t])?e.get(o[t])?(s[t].style.opacity="1",console.log("[KEEP] keeping tweet: "+o[t])):(s[t].style.display="none",console.log("[REMOVE] tweet: "+o[t])):console.log("[ERROR] cache does not contain tweet: "+o[t])}}))}})),n=!1)}),3e3)})();